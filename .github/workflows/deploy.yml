# GitHub Actions Deployment Workflow
# Generated with the help of Claude Sonnet 4.5
# Reviewed by Andrew Kelton


name: Deploy to Digital Ocean

on:
  push:
    branches:
      - staging
      # - main  # Uncomment to deploy from main branch as well

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Deploy to Digital Ocean
      env:
        SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
        SERVER_IP: 209.97.158.98
      run: |
        # Setup SSH
        mkdir -p ~/.ssh
        echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan -H $SERVER_IP >> ~/.ssh/known_hosts
        
        # Deploy to server
        ssh -o StrictHostKeyChecking=no root@$SERVER_IP << 'EOF'
          cd /var/www/html
          
          # Remove old files (optional - be careful with this)
          # rm -rf *
          
          # Clone or pull the repository
          if [ -d ".git" ]; then
            git pull origin staging
          else
            git clone -b staging https://github.com/AdamAddem/Small-Project.git .
          fi
          
          # Add any additional deployment commands here
          # For example:
          # npm install
          # composer install
          # systemctl restart nginx
        EOF